- name: download java
  get_url:
    url: "{{ java_dounload_url }}"
    dest: "/tmp/{{ java_archive }}"
    validate_certs: no
    headers: "Cookie: ' gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie'"
    sha256sum: "{{ java_sha256 }}"

- name: should exist base dir
  file:
    dest: "{{ base_dir }}"
    state: directory
    recurse: true
    mode: 0755

- name: extract java
  become: true
  environment:
    LANG: C
    LC_ALL: C
    LC_MESSAGES: C
  unarchive:
    copy: no
    src: "/tmp/{{ java_archive }}"
    dest: "{{ base_dir }}"
    creates: "{{ jdk_dir }}"

- name: create symlink
  file:
    src: "{{ jdk_dir }}"
    dest: "{{ JAVA_HOME }}"
    state: link

- name: add to path
  blockinfile:
    create: yes
    dest: /etc/profile.d/java.sh
    mode: 0644
    block: |
      export JAVA_HOME={{ JAVA_HOME }}
      export PATH=$PATH:$JAVA_HOME/bin
